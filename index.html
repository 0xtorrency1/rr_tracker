<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Trade Tracker</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    input, button { margin: 5px 0; padding: 8px; width: 100%; }
    table { width: 100%; margin-top: 20px; border-collapse: collapse; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #f0f0f0; }
  </style>
</head>
<body>

  <h2>Trade Tracker</h2>

  <label>Starting Balance ($):</label>
  <input type="number" id="balanceInput" placeholder="e.g. 100">

  <label>Risk % Per Trade:</label>
  <input type="number" id="riskPercent" placeholder="e.g. 5">

  <label>Risk:Reward Ratio (e.g. 1.5, 2):</label>
  <input type="number" step="0.1" id="rrRatio" placeholder="e.g. 1.5">

  <button onclick="setInitial()">Start / Update Balance</button>

  <div id="tracker" style="display:none;">
    <p><strong>Current Balance:</strong> $<span id="currentBalance">0</span></p>
    <p><strong>Next Risk:</strong> <span id="nextRiskPercent">0</span>% = $<span id="nextRiskAmount">0</span></p>
    <p><strong>Profit Factor:</strong> <span id="profitFactor">-</span></p>

    <button onclick="recordTrade(true)">Win Trade</button>
    <button onclick="recordTrade(false)">Lose Trade</button>
    <button onclick="resetTracker()">Reset</button>

    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>Prev Balance</th>
          <th>Result</th>
          <th>New Balance</th>
          <th>Risk $</th>
          <th>RR</th>
        </tr>
      </thead>
      <tbody id="history"></tbody>
    </table>
  </div>

  <script>
    let balance = 0;
    let tradeCount = 0;
    let history = [];
    let riskPercent = 5;
    let rr = 1;

    let grossProfit = 0;
    let grossLoss = 0;

    window.onload = () => {
      if (localStorage.getItem("trackerData")) {
        const data = JSON.parse(localStorage.getItem("trackerData"));
        balance = data.balance;
        tradeCount = data.tradeCount;
        history = data.history || [];
        riskPercent = data.riskPercent || 5;
        rr = data.rr || 1;
        grossProfit = data.grossProfit || 0;
        grossLoss = data.grossLoss || 0;

        document.getElementById("riskPercent").value = riskPercent;
        document.getElementById("rrRatio").value = rr;
        document.getElementById("balanceInput").value = balance;

        updateTracker();
        renderHistory();
        document.getElementById("tracker").style.display = "block";
      }
    };

    function setInitial() {
      balance = parseFloat(document.getElementById("balanceInput").value);
      riskPercent = parseFloat(document.getElementById("riskPercent").value);
      rr = parseFloat(document.getElementById("rrRatio").value);
      if (isNaN(balance) || isNaN(riskPercent) || isNaN(rr)) return alert("Please fill in all fields correctly.");

      tradeCount = 0;
      history = [];
      grossProfit = 0;
      grossLoss = 0;
      saveData();
      updateTracker();
      renderHistory();
      document.getElementById("tracker").style.display = "block";
    }

    function recordTrade(win) {
      const prev = balance;
      const riskAmount = (riskPercent / 100) * balance;
      const reward = win ? riskAmount * rr : -riskAmount;
      balance += reward;
      tradeCount++;

      if (win) {
        grossProfit += reward;
      } else {
        grossLoss += Math.abs(reward);
      }

      history.push({
        trade: tradeCount,
        prev: prev.toFixed(2),
        result: win ? "Win" : "Loss",
        newBal: balance.toFixed(2),
        risk: riskAmount.toFixed(2),
        rr: rr
      });

      saveData();
      updateTracker();
      renderHistory();
    }

    function updateTracker() {
      document.getElementById("currentBalance").textContent = balance.toFixed(2);
      document.getElementById("nextRiskPercent").textContent = riskPercent;
      document.getElementById("nextRiskAmount").textContent = ((riskPercent / 100) * balance).toFixed(2);

      const pf = grossLoss > 0 ? (grossProfit / grossLoss).toFixed(2) : grossProfit > 0 ? "âˆž" : "-";
      document.getElementById("profitFactor").textContent = pf;
    }

    function renderHistory() {
      const tbody = document.getElementById("history");
      tbody.innerHTML = "";
      history.forEach((h) => {
        const row = `<tr>
          <td>${h.trade}</td>
          <td>$${h.prev}</td>
          <td>${h.result}</td>
          <td>$${h.newBal}</td>
          <td>$${h.risk}</td>
          <td>${h.rr}</td>
        </tr>`;
        tbody.innerHTML += row;
      });
    }

    function resetTracker() {
      if (!confirm("Reset everything? This cannot be undone.")) return;
      balance = 0;
      tradeCount = 0;
      history = [];
      grossProfit = 0;
      grossLoss = 0;
      localStorage.removeItem("trackerData");
      document.getElementById("tracker").style.display = "none";
      alert("Reset complete. Reload the page to start fresh.");
    }

    function saveData() {
      const data = {
        balance,
        tradeCount,
        history,
        riskPercent,
        rr,
        grossProfit,
        grossLoss
      };
      localStorage.setItem("trackerData", JSON.stringify(data));
    }
  </script>

</body>
</html>
